<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangkok Smart Route</title>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-ui.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_API_KEY&libraries=places"></script>
    <link rel="stylesheet" href="https://js.api.here.com/v3/3.1/mapsjs-ui.css" />
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'IBM Plex Sans Thai', sans-serif;
        }

        #mapContainer {
            height: 100vh;
            width: 100vw;
        }
        .route-container {
            position: fixed;
            width: 360px;
            height: 110px; /* Reduced height */
            left: 50%;
            top: 10px;
            transform: translateX(-50%);
            background: #FFFFFF;
            border-radius: 10px;
            z-index: 1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 15px;
        }

        .start-point {
            position: absolute;
            width: 15px;
            height: 15.74px;
            left: 15px;
            top: 25px;
            background: #FEED30;
            border-radius: 90px;
        }

        .connector-dots {
            position: absolute;
            left: 20.5px;
            top: 45px;
            height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .dot {
            width: 4px;
            height: 4.2px;
            background: rgba(159, 159, 159, 0.25);
            border-radius: 90px;
        }

        .destination-icon {
            position: absolute;
            width: 15px;
            height: 15.74px;
            left: 15px;
            top: 70px;
            background: #FF4444;
            border-radius: 90px;
        }
        .input-group {
            position: absolute;
            width: 282px;
            height: 37px;
            left: 45px;
            background: #EDEDED;
            border-radius: 20px;
        }

        .location-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
        }
        .start-input {
            top: 15px;
        }

        .end-input {
            top: 60px;
        }
        @media (max-width: 400px) {
            .route-container {
                width: 90%;
                left: 50%;
                transform: translateX(-50%);
            }
        }
        input {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            padding: 0 14px;
            font-size: 12px;
            color: #747474;
            border-radius: 20px;
        }

        input::placeholder {
            color: #747474;
            font-weight: 400;
            font-size: 12px;
            line-height: 20px;
        }

        input:focus {
            outline: none;
        }

        .navigation-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            max-height: 50vh;
            overflow-y: auto;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1;
            padding: 15px;
        }

        .nav-header {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .nav-step {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .step-number {
            background: #4285f4;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }

        .step-instruction {
            flex: 1;
            font-size: 14px;
        }

        .step-distance {
            color: #666;
            font-size: 12px;
        }

        .route-instructions {
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="mapContainer"></div>
    
    <div class="route-container">
        <div class="start-point"></div>
        <div class="connector-dots">
            <div class="dot dot-1"></div>
            <div class="dot dot-2"></div>
            <div class="dot dot-3"></div>
        </div>
        <img class="destination-icon">
        
        <div class="input-group start-input">
            <input type="text" id="startPoint" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å...">
            <button id="currentLocation" class="location-btn">üìç</button>
        </div>
        <div class="input-group end-input">
            <input type="text" id="endPoint" list="landmarks" placeholder="‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á...">
        </div>
        <datalist id="landmarks">
            <option value="‡∏™‡∏¢‡∏≤‡∏°‡∏û‡∏≤‡∏£‡∏≤‡∏Å‡∏≠‡∏ô">
            <option value="‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏£‡∏±‡∏•‡πÄ‡∏ß‡∏¥‡∏•‡∏î‡πå">
            <option value="‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£">
            <option value="‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß">
            <option value="‡∏≠‡∏ô‡∏∏‡∏™‡∏≤‡∏ß‡∏£‡∏µ‡∏¢‡πå‡∏ä‡∏±‡∏¢‡∏™‡∏°‡∏£‡∏†‡∏π‡∏°‡∏¥">
            <option value="‡πÄ‡∏ó‡∏≠‡∏£‡πå‡∏°‡∏¥‡∏ô‡∏≠‡∏• 21">
            <option value="‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏™‡∏¢‡∏≤‡∏°">
            <option value="‡∏°‡∏≤‡∏ö‡∏∏‡∏ç‡∏Ñ‡∏£‡∏≠‡∏á">
            <option value="‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏û‡∏£‡∏∞‡∏à‡∏≠‡∏°‡πÄ‡∏Å‡∏•‡πâ‡∏≤‡πÄ‡∏à‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏´‡∏≤‡∏£‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á">
            <option value="‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏û‡∏£‡∏∞‡∏à‡∏≠‡∏°‡πÄ‡∏Å‡∏•‡πâ‡∏≤‡∏ò‡∏ô‡∏ö‡∏∏‡∏£‡∏µ">
            <option value="‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏û‡∏£‡∏∞‡∏à‡∏≠‡∏°‡πÄ‡∏Å‡∏•‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡πÄ‡∏´‡∏ô‡∏∑‡∏≠">
        </datalist>
    </div>
    
    <div class="routes-panel" id="routesList"></div>
    <div class="navigation-panel" id="navigationPanel">
        <div class="nav-header">
            <h3>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</h3>
        </div>
        <div class="nav-steps" id="navSteps"></div>
    </div>
    
    <script>
        let map, platform, router, searchService;
        const apiKey = 'iSbgEEz4fCcm1N_FJGjs1Al2ICMFfV5aTwpJ3WfZUB8';
        function initializeMap() {
            platform = new H.service.Platform({ 'apikey': apiKey });
            let defaultLayers = platform.createDefaultLayers();
            
            map = new H.Map(
                document.getElementById('mapContainer'),
                defaultLayers.vector.normal.map,
                {
                    zoom: 12,
                    center: { lat: 13.7563, lng: 100.5018 }
                }
            );

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° map events ‡πÅ‡∏•‡∏∞ behavior
            let behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
            let ui = H.ui.UI.createDefault(map, defaultLayers);
            
            router = platform.getRoutingService(null, 8);
            searchService = platform.getSearchService();

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            document.getElementById('currentLocation').addEventListener('click', getCurrentLocation);
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // ‡∏ã‡∏π‡∏°‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                        map.setCenter({lat: lat, lng: lng});
                        map.setZoom(16);
                        
                        // ‡πÅ‡∏õ‡∏•‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
                        searchService.reverseGeocode({
                            at: `${lat},${lng}`
                        }, result => {
                            const address = result.items[0].address.label;
                            document.getElementById('startPoint').value = address;
                            calculateRoutes();
                        }, error => {
                            console.error(error);
                        });
                    },
                    error => {
                        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πâ');
                    }
                );
            } else {
                alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á');
            }
        }

        function calculateRoutes() {
            const startPoint = document.getElementById('startPoint').value;
            const endPoint = document.getElementById('endPoint').value;

            if (!startPoint || !endPoint) return;

            geocodeAndRoute(startPoint, endPoint);
        }
        function geocodeAndRoute(start, end) {
            Promise.all([
                geocodeAddress(start),
                geocodeAddress(end)
            ]).then(([startCoords, endCoords]) => {
                // ‡∏ã‡∏π‡∏°‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                map.setCenter({lat: startCoords.lat, lng: startCoords.lng});
                map.setZoom(16);
                
                calculateMultiModalRoutes(startCoords, endCoords);
            }).catch(error => console.error(error));
        }

        function geocodeAddress(query) {
            return new Promise((resolve, reject) => {
                searchService.geocode({
                    q: query,
                    in: 'countryCode:THA'
                }, (result) => {
                    result.items.length ? resolve(result.items[0].position) : reject('Address not found');
                }, reject);
            });
        }

        function calculateMultiModalRoutes(start, end) {
            const routingParameters = {
                'routingMode': 'fast',
                'transportMode': 'car',
                'origin': `${start.lat},${start.lng}`,
                'destination': `${end.lat},${end.lng}`,
                'return': 'polyline,summary,actions,instructions',
                'spans': 'streetAttributes,names',
                'lang': 'th'  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            };

            router.calculateRoute(routingParameters, displayRoute, console.error);
        }

        function geocodeAddress(query) {
            return new Promise((resolve, reject) => {
                searchService.geocode({
                    q: query,
                    in: 'countryCode:THA',
                    lang: 'th'  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
                }, (result) => {
                    result.items.length ? resolve(result.items[0].position) : reject('Address not found');
                }, reject);
            });
        }

        function displayRoute(result) {
            if (!result.routes.length) return;

            // ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏Å‡πà‡∏≤
            map.removeObjects(map.getObjects());
            document.getElementById('routesList').innerHTML = '';

            const route = result.routes[0];
            const routeElement = document.createElement('div');
            routeElement.className = 'route-option';
    
            // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
            const duration = Math.round(route.sections[0].summary.duration / 60);
            const distance = (route.sections[0].summary.length / 1000).toFixed(1);
    
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
            let instructions = '';
            route.sections[0].actions.forEach((action, index) => {
                instructions += `
                    <div class="nav-step">
                        <span class="step-number">${index + 1}</span>
                        <span class="step-instruction">${action.instruction}</span>
                        ${action.length ? `<span class="step-distance">${(action.length).toFixed(0)} ‡πÄ‡∏°‡∏ï‡∏£</span>` : ''}
                    </div>
                `;
            });
    
            routeElement.innerHTML = `
                <div class="route-time">${duration} ‡∏ô‡∏≤‡∏ó‡∏µ</div>
                <div class="route-details">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ${distance} ‡∏Å‡∏°.</div>
                <div class="route-instructions">${instructions}</div>
            `;
    
            document.getElementById('routesList').appendChild(routeElement);
    
            // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            drawRoute(route);
    
            // ‡∏ã‡∏π‡∏°‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            map.getViewModel().setLookAtData({
                bounds: route.sections[0].bounds
            });
        }        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // Reverse geocode to get address
                        searchService.reverseGeocode({
                            at: `${lat},${lng}`
                        }, result => {
                            const address = result.items[0].address.label;
                            document.getElementById('startPoint').value = address;
                            calculateRoutes();
                        }, error => {
                            console.error(error);
                        });
                    },
                    error => {
                        console.error(error);
                        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πâ');
                    }
                );
            } else {
                alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á');
            }
        }
        function drawRoute(route) {
            route.sections.forEach((section) => {
                let linestring = H.geo.LineString.fromFlexiblePolyline(section.polyline);
                let routeLine = new H.map.Polyline(linestring, {
                    style: { strokeColor: '#4285f4', lineWidth: 5 }
                });
                map.addObject(routeLine);
            });
        }
        function initPlacesAutocomplete() {
            const startInput = document.getElementById('startPoint');
            const endInput = document.getElementById('endPoint');
            
            new google.maps.places.Autocomplete(startInput, {
                componentRestrictions: { country: 'th' }
            });
            
            new google.maps.places.Autocomplete(endInput, {
                componentRestrictions: { country: 'th' }
            });
        }
        
        window.onload = function() {
            initializeMap();
            initPlacesAutocomplete();
        };
    </script>
</body>
</html>

